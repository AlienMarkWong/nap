#!/usr/sh
########################################################################
# Makefile for parallel MD
#     by Ryo Kobayashi
########################################################################

#-----------------------------------------------------------------------
# to be generated by configure script
#-----------------------------------------------------------------------
CPP= @CPP@
CPPFLAGS= @CPPFLAGS@
#CPPFLAGS= -D__SHEAR__ -D__DISL__ -D__KOUKYU__ -D__WALL__
MPIFC= @FC@
MPIFLAGS= @FCFLAGS@
#-----------------------------------------------------------------------
# suffixes
.SUFFIXES: .o .f .F .f90 .F90
.f.o: 
	${MPIFC} -c ${MPIFLAGS} $<
.F.o: 
	${MPIFC} -c ${MPIFLAGS} ${CPPFLAGS} $<
.f90.o: 
	${MPIFC} -c ${MPIFLAGS} $<
.F90.o: 
	${MPIFC} -c ${MPIFLAGS} ${CPPFLAGS} $<

pmd= read_input.o parallel_md.o util_vec.o \
	lasubs.o util_pmd.o tensile_loading.o
mods= mod_variables.o
args= iargc.o getarg.o

forces= force_Ramas_FeH.o force_RK_FeH.o force_common.o force_RK_WHe.o \
	  force_Ito3_WHe.o force_LJ_Ar.o force_SW_Si.o force_EDIP_Si.o \
    force_Brenner.o force_Lu_WHe.o force_Branicio_AlN.o \
    force_Mishin_Al.o force_AFS_W.o force_SC_Fe.o \
    force_SM_Al.o
params=params_Ramas_FeH.h params_RK_FeH.h params_RK_WHe.h params_Ito3_WHe.h \
    params_LJ_Ar.h params_SW_Si.h params_EDIP_Si.h \
    params_Brenner.h params_Lu_WHe.h params_Branicio_AlN.h \
    params_Mishin_Al.h params_AFS_W.h params_SC_Fe.h \
    params_SM_Al.h

#-----mkconf program selection
mkconf_fcc= mkconf_fcc.o
mkconf_fcc_droplet= mkconf_fcc_droplet.o
mkconf_Al_fcc= mkconf_Al_fcc.o
mkconf_Al_FCC_edge= mkconf_Al_FCC_edge-disl.o
mkconf_2D_2kind= mkconf_2D_2kind.o
mkconf_2D_edge_disl= mkconf_2D_edge_disl.o
mkconf_Al_fcc_nanorod= mkconf_Al_fcc_nanorod.o
mkconf_Si111_2lc= mkconf_Si111_2lc.o
mkconf_Si_bulk= mkconf_Si_bulk.o
mkconf_Si_disl_screw_60= mkconf_Si_disl_screw_60.o
mkconf_BCC= mkconf_BCC.o
mkconf_BCC_nanorod= mkconf_BCC_nanorod.o
mkconf_BCC_FeH= mkconf_BCC_Fe-H.o
mkconf_BCC_edge= mkconf_BCC_edge-disl.o
mkconf_BCC_screw= mkconf_BCC_screw.o
mkconf_BCC_WHe= mkconf_BCC_W-He.o
mkconf_WHe_compress= mkconf_W-He-compress.o
mkconf_W_surface_migrate= mkconf_W_surface_migrate.o

#-----------------------------------------------------------------------
# Post process programs
#
comb= combine_pmd.o read_input.o util_pmd.o sort.o
pmd2akr= pmd2akr.o read_input.o util_pmd.o sort.o

#-----------------------------------------------------------------------
# Make rule entries
#
execs=nconv pmd combine pmd2akr akr2cna sortpmd

all: ${execs}

clean:
	rm -f *.o *.mod *~ ${execs}

nconv: node_conv.o ${mods} read_input.o util_pmd.o
	${MPIFC} -o $@ ${mods} node_conv.o read_input.o util_pmd.o

pmd: ${mods} ${pmd} ${forces} ${params}
	${MPIFC} ${MPIFLAGS} -o $@ ${mods} ${forces} ${pmd}

combine: ${comb} ${mods}
	${MPIFC} -o $@  ${mods} ${comb}

pmd2akr: ${pmd2akr} ${mods}
	${MPIFC} -o $@ ${mods} ${pmd2akr}

akr2cna: akr2cna.o sort.o
	${MPIFC} -o $@ akr2cna.o sort.o

akr2csp: akr2csp.o
	${MPIFC} -o $@ akr2csp.o

akr2pot: akr2pot.o
	${MPIFC} -o $@ akr2pot.o

akr2ddm: akr2ddm.o
	${MPIFC} -o $@ akr2ddm.o

akr2ddplot: akr2ddplot.o
	${MPIFC} -o $@ akr2ddplot.o

cna2disl: cna2disl.o
	${MPIFC} -o $@ cna2disl.o

rdpmd: read_pmd.o ${mods}
	${MPIFC} -o $@ read_pmd.o ${mods}

boxsize: change_pmd_boxsize.o ${mods} util_pmd.o
	${MPIFC} -o $@ change_pmd_boxsize.o ${mods} util_pmd.o

sortpmd: sort_pmd.o ${mods} util_pmd.o sort.o
	${MPIFC} -o $@ sort_pmd.o ${mods} util_pmd.o sort.o

#.....mkconfs
mkconf_fcc: ${mkconf_fcc} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_fcc} util_pmd.o

mkconf_Al_fcc: ${mkconf_Al_fcc} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_Al_fcc} util_pmd.o

mkconf_Al_FCC_edge: ${mkconf_Al_FCC_edge} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_Al_FCC_edge} util_pmd.o

mkconf_2D_edge_disl: ${mkconf_2D_edge_disl} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_2D_edge_disl} util_pmd.o

mkconf_Al_fcc_nanorod: ${mkconf_Al_fcc_nanorod} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_Al_fcc_nanorod} util_pmd.o

mkconf_Si_bulk: ${mkconf_Si_bulk} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_Si_bulk} util_pmd.o

mkconf_Si_disl_screw_60: ${mkconf_Si_disl_screw_60} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_Si_disl_screw_60} util_pmd.o

mkconf_BCC: ${mkconf_BCC} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_BCC} util_pmd.o

mkconf_BCC_FeH: ${mkconf_BCC_FeH} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_BCC_FeH} util_pmd.o

mkconf_BCC_edge: ${mkconf_BCC_edge} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_BCC_edge} util_pmd.o

mkconf_BCC_screw: ${mkconf_BCC_screw} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_BCC_screw} util_pmd.o

mkconf_BCC_WHe: ${mkconf_BCC_WHe} util_pmd.o ${mods}
	${MPIFC} -o $@ ${mods} ${mkconf_BCC_WHe} util_pmd.o


#.....Dependencies
parallel_md.o: ${mods} ${forces}
read_input.o:  ${mods}
node_conv.o:   ${mods}
combine_pmd.o: ${mods}
pmd2akr.o: ${mods}
force_Ito_W-He.o: ${mods}
force_Ramas_FeH.o: params_Ramas_FeH.h
force_RK_FeH.o: params_RK_FeH.h
force_RK_WHe.o: params_RK_WHe.h
force_Ito3_WHe.o: params_Ito3_WHe.h
force_LJ_Ar.o: params_LJ_Ar.h
force_SW_Si.o: params_SW_Si.h
force_EDIP_Si.o: params_EDIP_Si.h
force_Brenner.o: params_Brenner.h
force_Lu_WHe.o: params_Lu_WHe.h
force_Branicio_AlN.o: params_Branicio_AlN.h
force_Mishin_Al.o: params_Mishin_Al.h force_common.o

